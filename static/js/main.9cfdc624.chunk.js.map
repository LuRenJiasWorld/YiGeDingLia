{"version":3,"sources":["index.tsx"],"names":["getFirstPinyin","pinyin","normalize","replace","getLastPinyin","fix","data","word","endsWith","indexed","json","result","firstPinyin","lastPinyin","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Symbol","iterator","next","done","value","length","key1","values1","push","key2","values2","err","return","pinyins","Set","_loop","level","newpinyins","forEach","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","add","console","log","concat","size","handle","input","state","_loop2","v","filtered","filter","d","Math","floor","random","_ret","ReactDOM","render","react__WEBPACK_IMPORTED_MODULE_2___default","a","createElement","_React$useState","React","useState","_React$useState2","Object","_home_travis_build_ustc_zzzz_YiGeDingLia_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_1__","setState","_React$useState3","_React$useState4","seq","setSeq","keys","className","type","onChange","e","target","map","key","href","error","style","color","url","fetch","then","res","catch","_home_travis_build_ustc_zzzz_YiGeDingLia_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_0__","document","getElementsByTagName"],"mappings":"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","file":"static/js/main.9cfdc624.chunk.js","sourcesContent":["import React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport './github-markdown.css';\n\ninterface Data {\n  abbreviation: string\n  derivation: string\n  example: string\n  explanation: string\n  pinyin: string\n  word: string\n  level?: number\n}\n\ninterface State {\n  firstPinyin: {\n    [key: string]: Data[]\n  }\n  lastPinyin: {\n    [key: string]: Data[]\n  }\n  word: {\n    [key: string]: Data\n  }\n  error?: string\n}\n\nconst getFirstPinyin = (pinyin: string) => {\n  return pinyin.normalize('NFKD').replace(/[^\\w\\s]|\\s.+/g, '')\n}\n\nconst getLastPinyin = (pinyin: string) => {\n  return pinyin.normalize('NFKD').replace(/[^\\w\\s]|.+\\s/g, '')\n}\n\nconst fix = (data: Data) => {\n  if ('味同嚼蜡' === data.word) {\n    data.pinyin = data.pinyin.replace('cù', 'là')\n  }\n  if (data.word.endsWith('俩')) {\n    data.pinyin = data.pinyin.replace('liǎng', 'liǎ')\n  }\n  data.pinyin = data.pinyin.replace(/yi([ēéěèêe])/g, 'y$1')\n  return data;\n}\n\nconst indexed = (json: Data[]) => {\n  const result: State = { firstPinyin: {}, lastPinyin: {}, word: {} }\n  for (const data of json) {\n    fix(data)\n    if (data.word.length === 4) {\n      const key1 = getLastPinyin(data.pinyin)\n      const values1 = result.lastPinyin[key1] || []\n      result.lastPinyin[key1] = values1\n      values1.push(data)\n\n      const key2 = getFirstPinyin(data.pinyin)\n      const values2 = result.firstPinyin[key2] || []\n      result.firstPinyin[key2] = values2\n      values2.push(data)\n\n      result.word[data.word] = data\n    }\n  }\n  let pinyins = new Set(['yi'])\n  for (let level = 1; pinyins.size > 0; ++level) {\n    const newpinyins = new Set<string>()\n    pinyins.forEach(pinyin => {\n      for (const data of result.lastPinyin[pinyin] || []) {\n        if (!data.level) {\n          data.level = level\n          newpinyins.add(getFirstPinyin(data.pinyin))\n        }\n      }\n    })\n    console.log(`Generate ${newpinyins.size} entries for level ${level}`)\n    pinyins = newpinyins\n  }\n  return result\n}\n\nconst handle = (input: string, state: State) => {\n  const result: string[] = []\n  let data = state.word[input]\n  while (data && data.level) {\n    const level = data.level\n    result.push(`${data.word}（${data.pinyin}）`)\n    if (level > 1) {\n      const next = state.firstPinyin[getLastPinyin(data.pinyin)]\n      const filtered = next.filter(d => d.level && d.level < level)\n      data = filtered[Math.floor(Math.random() * filtered.length)]\n    } else {\n      result.push('一个顶俩（yī gè dǐng liǎ）')\n      return result\n    }\n  }\n  return result\n}\n\nfunction App() {\n  const [state, setState] = React.useState<State>({ firstPinyin: {}, lastPinyin: {}, word: {} })\n  const [seq, setSeq] = React.useState<string[]>([])\n\n  if (Object.keys(state.word).length > 0) {\n    return <div className='markdown-body'>\n      <h1>一个顶俩</h1>\n      <p>请输入一个四字成语，如成功识别：</p>\n      <p>本页面将自动为你接龙到“一个顶俩”</p>\n      <p><input type='input' onChange={e => setSeq(handle(e.target.value, state))} /></p>\n      <ul>{seq.map(data => {\n        return <li key={data}>{data}</li>\n      })}</ul>\n      <p>网页来源：<a href='https://github.com/ustc-zzzz/yigedinglia'>https://github.com/ustc-zzzz/yigedinglia</a></p>\n      <p>数据来源：<a href='https://github.com/pwxcoo/chinese-xinhua'>https://github.com/pwxcoo/chinese-xinhua</a></p>\n    </div>\n  } else if (state.error) {\n    return <div className='markdown-body'>\n      <h1>一个顶俩</h1>\n      <p style={{color: 'red'}}>{`数据加载中...加载异常，请刷新重试：${state.error}`}</p>\n      <p>网页来源：<a href='https://github.com/ustc-zzzz/yigedinglia'>https://github.com/ustc-zzzz/yigedinglia</a></p>\n      <p>数据来源：<a href='https://github.com/pwxcoo/chinese-xinhua'>https://github.com/pwxcoo/chinese-xinhua</a></p>\n    </div>\n  } else {\n    const base = 'https://raw.githubusercontent.com'\n    const url = `${base}/pwxcoo/chinese-xinhua/master/data/idiom.json`\n    fetch(url).then(res => res.json()).then(json => setState(indexed(json))).catch(error => setState({...state, error}))\n    return <div className='markdown-body'>\n      <h1>一个顶俩</h1>\n      <p>数据加载中...</p>\n      <p>网页来源：<a href='https://github.com/ustc-zzzz/yigedinglia'>https://github.com/ustc-zzzz/yigedinglia</a></p>\n      <p>数据来源：<a href='https://github.com/pwxcoo/chinese-xinhua'>https://github.com/pwxcoo/chinese-xinhua</a></p>\n    </div>\n  }\n}\n\nReactDOM.render(<App />, document.getElementsByTagName('main')[0])\n"],"sourceRoot":""}